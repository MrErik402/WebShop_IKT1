<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Társas estek</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

	
    <link rel="stylesheet" href="./Styles/output.css">

    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>

    <script>
        import { Modal } from 'flowbite';
    </script>

    
</head>

<body onload="updateCartNumber()" class="bg-tarsas1-light dark:bg-tarsas4-dark flex flex-col min-h-screen relative">   
    <!-- Ide kerul a navbar a ../Components/Navbar.js ből-->

    
    <div id="tartalom" class="md:pl-8 pr-0 py-16 pt-0 flex flex-col md:flex-row gap-8 md:gap-0">
        <div id="kosarTartalom" class="md:w-3/4 pt-4 flex flex-col gap-6 w-full items-center">
            
            
            
        </div>
        <div id="osszegzes" class="md:w-1/4 w-full bg-white p-2 h-fit text-lg font-semibold">
            <p class="">3 termék ára:</p>
            <p id="fizetesTermekOsszeg">11.000 Ft</p>
            <hr>
            <p>Szállítási költség:</p>
            <p>1 000 Ft</p>
            <hr>
            <p>Végösszeg</p>
            <p id="fizetesVegosszeg">12.000 Ft</p>
            <hr>
            <div class="flex flex-col pt-6">
                <div class="mb-2">
                    <input type="checkbox" name="aszfElfogad" id="aszfElfogad" class="bg-gray-300">
                    <label for="aszfElfogad">*Elfogadom az ÁSZF-et</label>
                </div>
                <div>
                    <input type="checkbox" name="hirlevelElfogad" id="hirlevelElfogad" class="bg-gray-300">
                    <label for="hirlevelElfogad">Feliratkozom a hírlevélre</label>
                </div>
                <button onclick="fizugomb()" class="block bg-tarsas4-light dark:bg-tarsas4-dark text-white px-6 py-2 rounded-xl mt-4" type="button">
                    Fizetés
                </button>
            </div>
        </div>
    </div>
    <div id="authentication-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-md max-h-full">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow-sm dark:bg-[#704264]">
                <!-- Modal header -->
                <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600 border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                        Fizetés és szállítási adatok
                    </h3>
                    <button type="button" class="end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="authentication-modal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <div class="p-4 md:p-5">
                    <form class="space-y-4" action="#">
                        <div>
                            <label for="email" class="block mb-2 text-sm font-medium dark:text-white">Email:</label>
                            <input type="email" name="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5" required>
                        </div>
                        <div>
                            <label for="nev" class="block mb-2 text-sm font-medium dark:text-white">Név:</label>
                            <input type="text" name="nev" id="nev" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5" required>
                        </div>
                        <div>
                            <label for="tel" class="block mb-2 text-sm font-medium dark:text-white">Telefonszám:</label>
                            <input type="text" name="tel" id="tel" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5" required>
                        </div>

                        <div class="flex gap-4">
                            <div class="w-1/3">
                                <label for="irszam" class="block mb-2 text-sm font-medium dark:text-white">Irányítószám:</label>
                                <input type="text" name="tel" id="tel" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5" required>
                            </div>
                            <div class="w-2/3">
                                <label for="telepules" class="block mb-2 text-sm font-medium dark:text-white">Település:</label>
                                <input type="text" name="tel" id="tel" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5" required>
                            </div>
                        </div>

                        <div>
                            <label for="cim" class="block mb-2 text-sm font-medium dark:text-white">Utca, házszám:</label>
                            <input type="text" name="cim" id="cim" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5" required>
                        </div>

                        
                        <p class="text-sm dark:text-white">Fizetési mód:</p>
                        <div class="flex justify-between">
                            <div class="flex items-center">
                                <input id="fizetes-radio-1" type="radio" value="" name="fizetes-radio" class="w-4 h-4 bg-gray-300 border-gray-300 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-200 dark:border-gray-600">
                                <label for="fizetes-radio-1" class="ms-2 text-sm font-medium text-gray-900 dark:text-white">Utánvét</label>
                            </div>
                            <div class="flex items-center">
                                <input checked id="fizetes-radio-2" type="radio" value="" name="fizetes-radio" class="w-4 h-4 bg-gray-300 border-gray-300 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-200 dark:border-gray-600">
                                <label for="fizetes-radio-2" class="ms-2 text-sm font-medium text-gray-900 dark:text-white">Bankkártya</label>
                            </div>
                        </div>
                        <button type="submit" class="w-full text-white bg-[#867070] font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-[#49243E]">Fizetés megerősítése</button>
                        
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="popUp hidden  fixed top-0 right-0 w-60 bg-[#D5B4B4]  z-50 h-screen overflow-y-hidden">
        <div onClick="closePopUp()" class=" text-center hover:cursor-pointer  max-w-10 h-6 p-1 relative left-0">
            <img src="../Pictures/x-Kosar.png" />
        </div>
        <div class="innerContent  overflow-y-scroll h-full w-full px-4 pt-2 pb-8">
                <div class="flex flex-col items-center mx-auto">
                    <img class="w-20" src="../../Pictures/popupshoppingcart.png" alt="">
                    <h1 class="pt-2">Összesen</h1>
                    <h1 class="pt-1 pb-4 font-bold" id="finalPrice">0$</h1>
                    <button onClick="closePopUp()" class="fizetes ring-1 max-w-screen-lg w-full ring-gray-400 p-1 bg-[#867070] text-white rounded-md">
                        Fizetés
                    </button>
                    <div class="kosarbanLevoTermekek mt-5 flex flex-col gap-2">
                        
                    </div>
                </div>
        </div>
      </div>

    <div class="footer"></div>
    
    <script src="./Javascript/Products/Products.js"></script>
    <script src="./Javascript/Cart/Cart.js"></script>
    <script src="../Components/Navbar.js"></script>
    <script src="../Components/Footer.js"></script>


    <script>
    

    const $targetEl = document.getElementById('authentication-modal');

    const modal = new Modal($targetEl);


    let fizugomb = () => {
        if (document.getElementById("aszfElfogad").checked) {
            modal.toggle();
        } else {
            alert("Az ÁSZF-et kötelező elfogadni!");
        }
    }

    


    window.popUp = function() {
        document.querySelector(".kosarbanLevoTermekek").innerHTML = ``;
        document.querySelector(".popUp").classList.remove("hidden");

        let sum = 0;

        if (cart.length == 0) {
            document.querySelector("#finalPrice").textContent = 0 + " Ft";
        }

        cart.forEach(value => {
            let id = value.id;
            let quantity = Number(value.quantity);
            let image = value.img;
            let ar = Number(value.ar);
            let formattedAr = new Intl.NumberFormat('hu-HU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(ar).replace(/\s/g, '\u00A0');
            let nev = value.nev;

            sum += ar * quantity;

            document.querySelector("#finalPrice").textContent = new Intl.NumberFormat('hu-HU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(sum).replace(/\s/g, '\u00A0') + " Ft";

            document.querySelector(".kosarbanLevoTermekek").innerHTML += `
                <div class="ring-1 ring-black/30">
                    <div class="flex flex-col item-container" data-id="${id}">
                        <img class="p-2 min-w-24 w-full max-w-24 h-full max-h-24 min-h-24 self-center" src="${image}" alt="">
                        <h1 class="pt-2 px-1 font-thin">${nev}</h1>
                        <div class="flex gap-2 justify-between px-1 pb-2">
                            <h1 class="text-right float-right font-medium">${formattedAr} Ft</h1>
                            <input onChange="inputChange(${id}, Number(this.value))" min="0" type="number" value="${quantity}" class="w-8 bg-white/50" />
                        </div>
                        <button class="hover:ring-1 ring-black/20 remove-item p-1 m-1 rounded-lg text-white bg-[#867070]">Eltávolítás</button>
                    </div>
                </div>
            `;
        });

        // "x" gomb event listener
        document.querySelectorAll(".remove-item").forEach(btn => {
            btn.addEventListener("click", (e) => {
                const id = parseInt(e.target.closest(".item-container").getAttribute("data-id"));
                console.log(id);
                if (confirm("⚠FIGYELEM RENDSZERÜZENET⚠\n\nEltávolítsuk ezt a tárgyat a kosaradból?")) {
                    removeThisItem(id, cart);
                }
            });
        });
    };

    window.removeThisItem = function (id) {
    if (id) {
        const index = cart.findIndex(item => item.id === id);
        cart.splice(index, 1); // Item törlése a kosárból
        saveTheCart();
        updateCartNumber();
        popUp();
        getCartItems();
    }
}

    
window.closePopUp = function(fizetes = false){
    document.querySelector(".kosarbanLevoTermekek").innerHTML = ``;
    document.querySelector(".popUp").classList.add("hidden");
    if (fizetes) {
        window.location.href = "./fizetes.html";
    }
}

window.inputChange = function (id, num){

    if(num < 0){
        num = 1;
    }
    else if(num == 0){
        if(confirm("⚠FIGYELEM RENDSZERÜZENET⚠\n\nBiztosan törölni szeretnéd a terméket a kosaradból?")){
            removeThisItem(id);
        }
        else{
            num = 1;
        }
    }

    const index = cart.findIndex(product => product.id === id)
    cart[index].quantity = num
    saveTheCart();
    updateCartNumber();
    popUp();
    getCartItems();
}


    </script>
    
</body>

</html>
